<app-navbar></app-navbar>

<div class="container">
  <h1>
    <div class="img-wrapper">
      <img src="../../../../../assets/images/profile.webp" alt="Profile" />
    </div>
    Sign Up
  </h1>
  <p class="alert" [class.error]="isError" *ngIf="alert">
    <span class="material-symbols-rounded" *ngIf="!isError"> done </span>
    <span class="material-symbols-rounded" *ngIf="isError"> error </span>
    {{ alertMessage }}
  </p>
  <div class="role-container">
    <h3>Choose a User Type<span class="required">*</span></h3>
    <div class="type-container" [class.mb]="!error">
      <div
        class="types"
        [class.border]="error"
        data-aos="fade-right"
        data-aos-duration="1000"
        data-aos-delay="100"
        data-aos-easing="ease-in-out"
      >
        <div class="img-container">
          <img src="../../../../../assets/images/farmer.png" alt="" />
        </div>
        <div class="type">
          <input
            type="radio"
            name="type"
            class="radio"
            value="Farmer"
            [(ngModel)]="type"
            (ngModelChange)="onRoleChange($event)"
          />
          <div>FARMER</div>
        </div>
      </div>
      <div
        class="types"
        [class.border]="error"
        data-aos="fade-left"
        data-aos-duration="1000"
        data-aos-delay="100"
        data-aos-easing="ease-in-out"
      >
        <div class="img-container">
          <img src="../../../../../assets/images/supplier.png" alt="" />
        </div>
        <div class="type">
          <input
            type="radio"
            name="type"
            class="radio"
            [(ngModel)]="type"
            value="Supplier"
            (ngModelChange)="onRoleChange($event)"
          />
          <div>SUPPLIER</div>
        </div>
      </div>
    </div>
  </div>

  <div class="error-types" [class.error-types-active]="error">
    <div *ngIf="role.invalid && (role?.dirty || role?.touched)">
      <small
        [style]="{ color: 'var(--red)' }"
        *ngIf="role?.errors?.['required']"
        >User type is required</small
      >
    </div>
  </div>

  <form [formGroup]="registerForm" (ngSubmit)="onSubmit()">
    <div class="form-group">
      <div class="input-group">
        <label>First Name<span class="required">*</span></label>
        <input
          pInputText
          formControlName="firstName"
          style="text-transform: capitalize"
          pKeyFilter="alpha"
        />
        <div
          *ngIf="firstName.invalid && (firstName?.dirty || firstName?.touched)"
        >
          <small
            [style]="{ color: 'var(--red)' }"
            *ngIf="firstName?.errors?.['required']"
            >First name is required</small
          >
        </div>
      </div>
      <div class="input-group">
        <label>Middle Name</label>
        <input
          pInputText
          formControlName="middleName"
          style="text-transform: capitalize"
          pKeyFilter="alpha"
        />
      </div>
      <div class="input-group">
        <label>Last Name<span class="required">*</span></label>
        <input
          pInputText
          formControlName="lastName"
          style="text-transform: capitalize"
          pKeyFilter="alpha"
        />
        <div *ngIf="lastName.invalid && (lastName?.dirty || lastName?.touched)">
          <small
            [style]="{ color: 'var(--red)' }"
            *ngIf="lastName?.errors?.['required']"
            >Last name is required</small
          >
        </div>
      </div>
      <div class="input-group">
        <label>Suffix</label>
        <input
          pInputText
          formControlName="suffix"
          style="text-transform: uppercase"
          pKeyFilter="alpha"
        />
      </div>
      <div class="input-group">
        <label>Gender<span class="required">*</span></label>
        <p-dropdown
          [options]="genders"
          placeholder="Select a gender"
          [style]="{
            width: '100%',
          }"
          appendTo="body"
          formControlName="gender"
        ></p-dropdown>
        <div *ngIf="gender.invalid && (gender?.dirty || gender.touched)">
          <small
            [style]="{ color: 'var(--red)' }"
            *ngIf="gender.errors?.['required']"
            >Gender is required</small
          >
        </div>
      </div>
      <div class="input-group">
        <label>Birthday<span class="required">*</span></label>
        <p-calendar
          [style]="{
            width: '100%',
          }"
          appendTo="body"
          [showIcon]="true"
          formControlName="birthdate"
          placeholder="MM/DD/YYYY"
        ></p-calendar>
        <div
          *ngIf="birthdate.invalid && (birthdate?.dirty || birthdate.touched)"
        >
          <small
            [style]="{ color: 'var(--red)' }"
            *ngIf="birthdate?.errors?.['required']"
            >Birthday is required</small
          >
          <small
            [style]="{ color: 'var(--red)' }"
            *ngIf="birthdate?.errors?.['futureDate']"
            >You cannot select a future date</small
          >
          <small
            [style]="{ color: 'var(--red)' }"
            *ngIf="birthdate?.errors?.['underage']"
            >You should be 18 and above</small
          >
        </div>
      </div>
      <div class="input-group">
        <label>Unit Number / House Number<span class="required">*</span></label>
        <input
          pInputText
          formControlName="unit"
          style="text-transform: capitalize"
        />
        <div *ngIf="unit.invalid && (unit?.dirty || unit.touched)">
          <small
            [style]="{ color: 'var(--red)' }"
            *ngIf="unit.errors?.['required']"
            >Unit Number / House Number is required</small
          >
        </div>
      </div>
      <div class="input-group">
        <label>Street<span class="required">*</span></label>
        <input
          pInputText
          formControlName="street"
          style="text-transform: capitalize"
        />
        <div *ngIf="street.invalid && (street?.dirty || street.touched)">
          <small
            [style]="{ color: 'var(--red)' }"
            *ngIf="street.errors?.['required']"
            >Street is required</small
          >
        </div>
      </div>
      <div class="input-group">
        <label
          >Subdivision / Village / Bldg<span class="required">*</span></label
        >
        <input
          pInputText
          formControlName="village"
          style="text-transform: capitalize"
        />
        <div *ngIf="village.invalid && (village?.dirty || village.touched)">
          <small
            [style]="{ color: 'var(--red)' }"
            *ngIf="village.errors?.['required']"
            >Subdivision / Village / Bldg is required</small
          >
        </div>
      </div>
      <div class="input-group">
        <label>Region<span class="required">*</span></label>
        <p-dropdown
          [options]="regions"
          optionLabel="name"
          placeholder="Select a region"
          [style]="{
            width: '100%'
          }"
          appendTo="body"
          formControlName="region"
          [(ngModel)]="regionSelected"
          (ngModelChange)="onRegionChange($event)"
        ></p-dropdown>
        <div *ngIf="region.invalid && (region?.dirty || region.touched)">
          <small
            [style]="{ color: 'var(--red)' }"
            *ngIf="region.errors?.['required']"
            >Region is required</small
          >
        </div>
      </div>
      <div class="input-group">
        <label>Province<span class="required">*</span></label>
        <p-dropdown
          [options]="provinces"
          optionLabel="name"
          placeholder="Select a province"
          [style]="{
            width: '100%'
          }"
          appendTo="body"
          formControlName="province"
          [(ngModel)]="provinceSelected"
          (ngModelChange)="onProvinceChange($event)"
        ></p-dropdown>
        <div *ngIf="province.invalid && (province?.dirty || province.touched)">
          <small
            [style]="{ color: 'var(--red)' }"
            *ngIf="province.errors?.['required']"
            >Province is required</small
          >
        </div>
      </div>
      <div class="input-group">
        <label>City<span class="required">*</span></label>
        <p-dropdown
          [options]="cities"
          optionLabel="name"
          placeholder="Select a city"
          [style]="{
            width: '100%'
          }"
          appendTo="body"
          formControlName="city"
          [(ngModel)]="citySelected"
          (ngModelChange)="onCityChange($event)"
        ></p-dropdown>
        <div *ngIf="city.invalid && (city?.dirty || city.touched)">
          <small
            [style]="{ color: 'var(--red)' }"
            *ngIf="city.errors?.['required']"
            >City is required</small
          >
        </div>
      </div>
      <div class="input-group">
        <label>Barangay<span class="required">*</span></label>
        <p-dropdown
          [options]="barangays"
          optionLabel="name"
          placeholder="Select a barangay"
          [style]="{
            width: '100%'
          }"
          appendTo="body"
          formControlName="barangay"
        ></p-dropdown>
        <div *ngIf="barangay.invalid && (barangay?.dirty || barangay.touched)">
          <small
            [style]="{ color: 'var(--red)' }"
            *ngIf="barangay.errors?.['required']"
            >Barangay is required</small
          >
        </div>
      </div>
      <div class="input-group">
        <label>Contact Number<span class="required">*</span></label>
        <input pInputText formControlName="contact" pKeyFilter="int" />
        <div *ngIf="contact.invalid && (contact?.dirty || contact.touched)">
          <small
            [style]="{ color: 'var(--red)' }"
            *ngIf="contact.errors?.['required']"
            >Contact Number is required</small
          >
          <small
            [style]="{ color: 'var(--red)' }"
            *ngIf="contact?.errors?.['mobileNoIsValid']"
            >Invalid mobile number format</small
          >
        </div>
      </div>
      <div class="input-group">
        <label>Email Address<span class="required">*</span></label>
        <input pInputText formControlName="email" />
        <div *ngIf="email.invalid && (email?.dirty || email.touched)">
          <small
            [style]="{ color: 'var(--red)' }"
            *ngIf="email.errors?.['required']"
            >Email address is required</small
          >
          <small
            [style]="{ color: 'var(--red)' }"
            *ngIf="email.errors?.['email']"
            >Invalid email</small
          >
        </div>
      </div>
      <div class="input-group">
        <label>Username<span class="required">*</span></label>
        <input pInputText formControlName="username" />
        <div *ngIf="username.invalid && (username?.dirty || username.touched)">
          <small
            [style]="{ color: 'var(--red)' }"
            *ngIf="username.errors?.['required']"
            >Username is required</small
          >
        </div>
      </div>
      <div class="input-group">
        <label>Password<span class="required">*</span></label>
        <div class="password-container">
          <input
            pInputText
            [type]="pass ? 'text' : 'password'"
            [style]="{
              width: '100%'
            }"
            formControlName="password"
          />
          <div class="pass-icon" (click)="togglePassword()">
            <span class="material-symbols-rounded">
              {{ pass ? "visibility" : "visibility_off" }}
            </span>
          </div>
        </div>
        <div *ngIf="password.invalid && (password?.dirty || password.touched)">
          <small
            [style]="{ color: 'var(--red)' }"
            *ngIf="password.errors?.['required']"
            >Password is required</small
          >
          <small
            [style]="{ color: 'var(--red)' }"
            *ngIf="password?.errors?.['passwordLength']"
            >Password should be at least 8 characters long</small
          >
          <small
            [style]="{ color: 'var(--red)' }"
            *ngIf="password?.errors?.['hasUppercase']"
            >Password should contain at least one uppercase letter</small
          >
          <small
            [style]="{ color: 'var(--red)' }"
            *ngIf="password?.errors?.['hasLowercase']"
            >Password should contain at least one lowercase letter</small
          >
          <small
            [style]="{ color: 'var(--red)' }"
            *ngIf="password?.errors?.['hasNumber']"
            >Password should contain at least one number</small
          >
          <small
            [style]="{ color: 'var(--red)' }"
            *ngIf="password?.errors?.['hasSymbol']"
            >Password should contain at least one special character</small
          >
        </div>
      </div>
      <div class="input-group">
        <label>Confirm Password<span class="required">*</span></label>
        <div class="password-container">
          <input
            pInputText
            [type]="confirmPass ? 'text' : 'password'"
            [style]="{
              width: '100%'
            }"
            formControlName="confirmPassword"
          />
          <div class="pass-icon" (click)="toggleConfirmPassword()">
            <span class="material-symbols-rounded">
              {{ confirmPass ? "visibility" : "visibility_off" }}
            </span>
          </div>
        </div>
        <div
          *ngIf="
            confirmPassword.invalid &&
            (confirmPassword?.dirty || confirmPassword.touched)
          "
        >
          <small
            [style]="{ color: 'var(--red)' }"
            *ngIf="confirmPassword.errors?.['required']"
            >Confirm password is required</small
          >
          <small
            [style]="{ color: 'var(--red)' }"
            *ngIf="confirmPassword?.errors?.['passwordMismatch']"
            >Passwords does not match</small
          >
        </div>
      </div>
      <div class="input-group">
        <label>ID Type<span class="required">*</span></label>
        <p-dropdown
          [options]="idTypes"
          placeholder="Select an ID Type"
          [style]="{
            width: '100%'
          }"
          appendTo="body"
          formControlName="idType"
        ></p-dropdown>
        <div *ngIf="idType.invalid && (idType?.dirty || idType.touched)">
          <small
            [style]="{ color: 'var(--red)' }"
            *ngIf="idType.errors?.['required']"
            >ID type is required</small
          >
        </div>
      </div>
      <div class="input-group">
        <label>ID Number<span class="required">*</span></label>
        <input pInputText formControlName="idNumber" pKeyFilter="int" />
        <div *ngIf="idNumber.invalid && (idNumber?.dirty || idNumber.touched)">
          <small
            [style]="{ color: 'var(--red)' }"
            *ngIf="idNumber.errors?.['required']"
            >ID Number is required</small
          >
        </div>
      </div>
    </div>

    <div class="form-group">
      <div class="input-group">
        <label>Front ID<span class="required">*</span></label>
        <div
          class="id-img-container {{ idFrontEmpty ? 'border' : 'show-border' }}"
        >
          <img src="{{ idFront }}" alt="Front Id" *ngIf="idFrontPreview" />
        </div>
        <div
          *ngIf="filename2.invalid && (filename2?.dirty || filename2?.touched)"
        >
          <small
            [style]="{ color: 'var(--red)' }"
            *ngIf="filename2?.errors?.['required']"
            >Front ID is required</small
          >
        </div>
        <button class="btn-upload">
          <span class="material-symbols-rounded icon"> upload </span>
          Upload<input
            type="file"
            class="file"
            accept="image/*"
            (change)="onFileSelected($event)"
          />
        </button>
      </div>
      <div class="input-group">
        <label>Back ID<span class="required">*</span></label>
        <div
          class="id-img-container {{ idBackEmpty ? 'border' : 'show-border' }}"
        >
          <img src="{{ idBack }}" alt="Back Id" *ngIf="idBackPreview" />
        </div>
        <div
          *ngIf="filename1.invalid && (filename1?.dirty || filename1?.touched)"
        >
          <small
            [style]="{ color: 'var(--red)' }"
            *ngIf="filename1?.errors?.['required']"
            >Back ID is required</small
          >
        </div>
        <button class="btn-upload">
          <span class="material-symbols-rounded icon"> upload </span>
          Upload<input
            type="file"
            class="file"
            accept="image/*"
            (change)="onFileSelected1($event)"
          />
        </button>
      </div>
    </div>
    <div class="fg">
      <div class="webcam-group">
        <label>Selfie<span class="required">*</span></label>
        <div class="btn-container" *ngIf="!hasChoosen">
          <button type="button" (click)="onSelfie()">
            <span class="material-symbols-rounded icon"> photo_camera </span
            >Take a Selfie
          </button>
          <div class="or">
            <span class="line"></span>
            <div>or</div>
            <span class="line"></span>
          </div>
          <button class="btn-file" type="button">
            <span class="material-symbols-rounded icon"> upload </span>Upload
            from Device
            <input
              type="file"
              class="file"
              accept="image/*"
              (change)="onFileSelected2($event)"
            />
          </button>
        </div>
        <ng-container *ngIf="hasChoosen">
          <ng-container *ngIf="upload">
            <div class="selfie-container">
              <img [src]="uploadImage" alt="Captured Image" />
            </div>
            <button type="button" (click)="onSelfie()">
              <span class="material-symbols-rounded icon"> photo_camera </span
              >Take a Selfie
            </button>
          </ng-container>
          <ng-container *ngIf="!upload"
            ><div class="webcam" *ngIf="!selfie">
              <webcam
                [width]="480"
                [height]="320"
                [trigger]="triggerObservable"
                (imageCapture)="handleImageCapture($event)"
                (initError)="handleInitError($event)"
              ></webcam>
            </div>
            <div class="selfie-container" *ngIf="selfie">
              <img [src]="webcamImage.imageAsDataUrl" alt="Captured Image" />
            </div>
            <div class="btn-container1">
              <button
                class="btn-capture {{ selfie ? 'none' : '' }}"
                (click)="captureSelfie()"
                type="button"
              >
                <span class="material-symbols-rounded icon">
                  photo_camera
                </span>
                Capture Image
              </button>
              <button
                class="{{ selfie ? 'mb' : 'none' }}"
                (click)="another()"
                type="button"
              >
                <span class="material-symbols-rounded icon"> photo_camera </span
                >Take Another Selfie
              </button>
              <button class="btn-file" type="button">
                <span class="material-symbols-rounded icon"> upload </span
                >Upload from Device
                <input
                  type="file"
                  class="file"
                  accept="image/*"
                  (change)="onFileSelected2($event)"
                />
              </button>
            </div>
          </ng-container>
        </ng-container>
        <div
          *ngIf="selfieImg.invalid && (selfieImg?.dirty || selfieImg?.touched)"
        >
          <small
            [style]="{ color: 'var(--red)' }"
            *ngIf="selfieImg?.errors?.['required']"
            >Selfie is required</small
          >
        </div>
      </div>
    </div>

    <button type="submit">Submit</button>
  </form>
</div>

<app-footer></app-footer>
